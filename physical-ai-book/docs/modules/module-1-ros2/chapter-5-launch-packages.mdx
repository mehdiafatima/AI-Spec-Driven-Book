---
sidebar_position: 5
---

# Chapter 5: Launch Files and Package Management

This chapter covers two essential aspects of ROS 2 development: **Launch Files** for orchestrating complex systems, and **Package Management** for organizing and building your robot software.

## ROS 2 Launch Files: Orchestrating Your System

**Launch files** in ROS 2 are XML or Python scripts that allow you to start multiple ROS 2 nodes simultaneously, configure their parameters, and set up the overall system. They are crucial for managing complex robot applications, eliminating the need to manually start each node and parameter.

### Key Features of Launch Files:

-   **Node Execution**: Start multiple nodes with a single command.
-   **Parameter Configuration**: Set parameters for nodes at startup.
-   **Remapping**: Change topic or service names to avoid conflicts or simplify interfaces.
-   **Conditional Execution**: Start nodes or apply configurations based on conditions.
-   **Group Management**: Organize nodes into logical groups.

### Launch File Structure (Python)

ROS 2 primarily uses Python-based launch files, offering greater flexibility and programmatic control compared to ROS 1's XML-based launch files.

A typical Python launch file looks like this:

```python
from launch import LaunchDescription
from launch_ros.actions import Node

def generate_launch_description():
    return LaunchDescription([
        Node(
            package='my_package',
            executable='talker',
            name='sim_talker',
            parameters=[{'use_sim_time': True}],
            remappings=[
                ('/chatter', '/robot/chatter')
            ]
        ),
        Node(
            package='my_package',
            executable='listener',
            name='robot_listener',
            output='screen'
        )
    ])
```

-   **`LaunchDescription`**: The root element of a launch file.
-   **`Node`**: An action to start a ROS 2 node.
    -   `package`: The name of the ROS 2 package containing the executable.
    -   `executable`: The name of the executable (node).
    -   `name`: (Optional) A unique name for this instance of the node.
    -   `parameters`: (Optional) A list of parameters to set for the node.
    -   `remappings`: (Optional) A list of topic/service remappings.
    -   `output`: (Optional) Redirects node output (e.g., `screen` to print to console).

### Creating and Running a Launch File

1.  **Create a ROS 2 package for launch files**:
    ```bash
    cd ~/ros2_ws/src
    ros2 pkg create --build-type ament_python my_launch_pkg
    ```
2.  **Create a `launch` directory in your package**:
    ```bash
    mkdir my_launch_pkg/launch
    ```
3.  **Create your Python launch file (`my_launch_pkg/launch/my_example_launch.py`)**:
    ```python
    from launch import LaunchDescription
    from launch_ros.actions import Node

    def generate_launch_description():
        return LaunchDescription([
            Node(
                package='demo_nodes_cpp',
                executable='talker',
                name='my_talker',
                output='screen',
            ),
            Node(
                package='demo_nodes_py',
                executable='listener',
                name='my_listener',
                output='screen',
                remappings=[
                    ('chatter', 'my_custom_chatter') # Remap the topic
                ]
            )
        ])
    ```
4.  **Edit `setup.py`**: In `my_launch_pkg/setup.py`, add the launch files to `data_files`:
    ```python
    from setuptools import setup
    import os
    from glob import glob

    package_name = 'my_launch_pkg'

    setup(
        name=package_name,
        version='0.0.0',
        packages=[package_name],
        data_files=[
            ('share/ament_index/resource_index/packages',
                ['resource/' + package_name]),
            ('share/' + package_name, ['package.xml']),
            (os.path.join('share', package_name, 'launch'), glob('launch/*.py')), # Add this line
        ],
        install_requires=['setuptools'],
        zip_safe=True,
        maintainer='your_name',
        maintainer_email='you@example.com',
        description='TODO: Package description',
        license='TODO: License declaration',
        tests_require=['pytest'],
        entry_points={
            'console_scripts': [],
        },
    )
    ```
5.  **Build and source your workspace**:
    ```bash
    cd ~/ros2_ws
    colcon build --packages-select my_launch_pkg
    source install/setup.bash
    ```
6.  **Run the launch file**:
    ```bash
    ros2 launch my_launch_pkg my_example_launch.py
    ```
    You should see both the `talker` and `listener` nodes start, and the listener will report "I heard: [message]" but the topic name it's listening to will be remapped.

## ROS 2 Package Management

ROS 2 organizes code into **packages**. A package is a directory that contains source code, build scripts, configuration files, and other resources related to a specific functionality (e.g., a package for camera drivers, a package for a robot's description).

### Package Structure

A typical ROS 2 package (Python or C++) contains:

-   **`package.xml`**: Manifest file with metadata (name, version, description, dependencies).
-   **`CMakeLists.txt` (C++) or `setup.py` (Python)**: Build system configuration.
-   **`src/`**: Source code for nodes, libraries, etc.
-   **`include/` (C++)**: Header files.
-   **`launch/`**: Launch files.
-   **`config/`**: YAML files for parameters.
-   **`urdf/`**: Robot description files.
-   **`msg/`, `srv/`, `action/`**: Custom message, service, and action definitions.

### `package.xml`

This XML file contains vital information about the package:

-   **`<name>`**: Unique package name.
-   **`<version>`**: Package version.
-   **`<description>`**: A brief description.
-   **`<maintainer>`**: Contact information for maintainers.
-   **`<license>`**: License under which the package is distributed.
-   **Dependencies**:
    -   `<build_depend>`: Packages needed to *build* this package.
    -   `<exec_depend>`: Packages needed to *run* this package.
    -   `<test_depend>`: Packages needed to *test* this package.

### Build System (`colcon`)

**`colcon`** is the primary build tool for ROS 2. It orchestrates the building of multiple packages in a workspace.

#### Common `colcon` commands:

-   **`colcon build`**: Builds all packages in the workspace.
-   **`colcon build --packages-select <package_name>`**: Builds only a specific package.
-   **`colcon build --packages-up-to <package_name>`**: Builds a specific package and all its dependencies.
-   **`colcon test`**: Runs tests for all packages.
-   **`colcon test --packages-select <package_name>`**: Runs tests for a specific package.
-   **`colcon clean`**: Removes build artifacts (useful for troubleshooting build issues).

### Overlaying Workspaces

ROS 2 allows for **overlaying workspaces**. This means you can have multiple workspaces, where packages in a "child" workspace can see and use packages from a "parent" workspace. This is useful for:

-   Developing new features without affecting stable code.
-   Working on multiple projects simultaneously.
-   Installing core ROS 2 packages system-wide and user-specific development in a separate workspace.

To overlay, you simply source the setup file of the parent workspace *before* sourcing the child workspace.

```bash
# Source base ROS 2 installation (e.g., /opt/ros/humble)
source /opt/ros/humble/setup.bash

# Source parent workspace (if any)
source ~/parent_ws/install/setup.bash

# Source your current development workspace
source ~/ros2_ws/install/setup.bash
```

## Conclusion

Launch files provide a powerful way to define and manage complex ROS 2 systems, automating the startup and configuration of multiple nodes. Effective package management using `package.xml` and `colcon` ensures modular, reusable, and maintainable robotics software. With these tools, you are well-equipped to build and deploy sophisticated ROS 2 applications.
